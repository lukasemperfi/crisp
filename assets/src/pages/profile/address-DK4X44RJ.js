import{i as D,a as S,l as w}from"../../../footer-hohNfXYL.js";import{i as d}from"../../../dropdown-Etj7YRTy.js";import{i as T}from"../../../breadcrumbs-Un-TCqts.js";import{i as h}from"../../../profile-section-Lnmzs4iE.js";import{J as L,R as n,c as C}from"../../../rules-BILaquOo.js";import{c as u,r as p}from"../../../index-ni-So6HJ.js";import{u as m}from"../../../profile-Byp8cCDH.js";import{a as A}from"../../../breadcrumbs-BENUYkyx.js";const c={FORM:"#address-form",COUNTRY:"#address-country",REGION:"#address-region",CITY:"#address-city"},g={[c.COUNTRY]:[n],[c.REGION]:[n],[c.CITY]:[n]};function b(){const r={errorFieldCssClass:"form-field__input_error",errorLabelCssClass:"form-field__error",focusInvalidField:!0,lockForm:!0,validateBeforeSubmitting:!0,errorFieldStyle:{},errorLabelStyle:{}},e=new L(c.FORM,r);for(const o in g)e.addField(o,g[o]);return e}const P=()=>{b().onSuccess(async e=>{e.preventDefault();const o=document.querySelector(c.FORM),t=new FormData(o),a=Object.fromEntries(t.entries()),s=I(a),l=C({successText:"Данные изменены успешно!"});try{await m.updateProfile(s),l.success(),setTimeout(()=>{window.location.reload()},1e3)}catch(f){console.error("Ошибка при обновлении профиля:",f),l.hide()}});const r=d({selector:".address-form__region-dropdown",disabled:!0});d({selector:".address-form__country-dropdown",items:u,onChange:(e,o)=>{G(o,r,p)}})};function G(r,e,o){const t=o[r]||[];e.updateOptions(t),t.length>0?e.setDisabled(!1):e.setDisabled(!0)}const _=(r,e,o)=>{const t={},a=[];for(const s in r)if(s.startsWith(e)){const l=s.replace(e,"");t[l]=r[s],a.push(s)}return a.forEach(s=>delete r[s]),r[o]=t,t},I=r=>{const e=r.person_type;return e==="fop"&&_(r,"fop_","fop"),e==="legal"&&_(r,"legal_entity_","legal_entity"),r},i={FORM:"#legal-address-form",COUNTRY:"#legal-address-country",REGION:"#legal-address-region",CITY:"#legal-address-city",LEGAL_OKPO:"#legal-entity-address-okpo",LEGAL_COUNTRY:"#legal-entity-address-country",LEGAL_REGION:"#legal-entity-address-region",LEGAL_CITY:"#legal-entity-address-city"},O={[i.COUNTRY]:[n],[i.REGION]:[n],[i.CITY]:[n],[i.LEGAL_COUNTRY]:[n],[i.LEGAL_REGION]:[n],[i.LEGAL_CITY]:[n],[i.LEGAL_OKPO]:[n]};function v(){const r={errorFieldCssClass:"form-field__input_error",errorLabelCssClass:"form-field__error",focusInvalidField:!0,lockForm:!0,validateBeforeSubmitting:!0,errorFieldStyle:{},errorLabelStyle:{}},e=new L(i.FORM,r);for(const o in O)e.addField(o,O[o]);return e}const M=()=>{v().onSuccess(async o=>{o.preventDefault();const t=document.querySelector(i.FORM),a=new FormData(t),l={...Object.fromEntries(a.entries()),person_type:"legal"},f=N(l),y=C({successText:"Данные изменены успешно!"});try{await m.updateProfile(f),y.success(),setTimeout(()=>{window.location.reload()},1e3)}catch(F){console.error("Ошибка при обновлении профиля:",F),y.hide()}});const r=d({selector:".legal-address-form__region-dropdown",disabled:!0});d({selector:".legal-address-form__country-dropdown",items:u,onChange:(o,t)=>{E(t,r,p)}});const e=d({selector:".legal-address-form__legal-entity-region-dropdown",disabled:!0});d({selector:".legal-address-form__legal-entity-country-dropdown",items:u,onChange:(o,t)=>{E(t,e,p)}})};function E(r,e,o){const t=o[r]||[];e.updateOptions(t),t.length>0?e.setDisabled(!1):e.setDisabled(!0)}const R=(r,e,o)=>{const t={},a=[];for(const s in r)if(s.startsWith(e)){const l=s.replace(e,"");t[l]=r[s],a.push(s)}return a.forEach(s=>delete r[s]),r[o]=t,t},N=r=>{const e=r.person_type;return e==="fop"&&R(r,"fop_","fop"),e==="legal"&&R(r,"legal_entity_","legal_entity"),r};document.addEventListener("DOMContentLoaded",async()=>{await A();try{if(d({selector:".top-header__lang"}),D(),T(),h(),(await m.getProfile()).person_type==="legal"){const e=document.querySelector(".legal-address-form-wrapper");e.style.display="flex",M()}else{const e=document.querySelector("#address-form");e.style.display="block",P()}S(),w(".lazy",{rootMargin:"200px 0px"})}catch{}});
