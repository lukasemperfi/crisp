import{s as f,b as E,i as D,a as R,l as q}from"../../footer-DhrWEGpA.js";import{i as b}from"../../dropdown-Etj7YRTy.js";import{m as I,Q as M}from"../../map-products-to-table-rows-D6tuKD9a.js";import{C as N}from"../../cart-Dyz0AvbZ.js";import{c as F}from"../../helpers-DngjoxpT.js";import{c as U,r as P}from"../../index-ni-So6HJ.js";import{J as T,R as h,a as V,E as x,b as Y,c as B}from"../../rules-BILaquOo.js";import{o as A}from"../../order-C4DZuqot.js";import{r as C}from"../../redirect-7MlKBWST.js";import{O as H}from"../../order-table-BcPZFJ6P.js";import{i as $}from"../../breadcrumbs-CCIHsRy6.js";import{g as G}from"../../auth-guard-YOWXcCuk.js";const c={FORM:"#checkout-form",FULL_NAME:"#checkout-form-full-name",EMAIL:"#checkout-form-email",PHONE:"#checkout-form-phone",COUNTRY:"#checkout-form-country",REGION:"#checkout-form-region",CITY:"#checkout-form-city",ADDRESS:"#checkout-form-address"},k={[c.FULL_NAME]:[h,Y],[c.EMAIL]:[h,x],[c.PHONE]:[h,V]};function Q(){const e={errorFieldCssClass:"form-field__input_error",errorLabelCssClass:"form-field__error",focusInvalidField:!0,lockForm:!0,validateBeforeSubmitting:!0,errorFieldStyle:{},errorLabelStyle:{}},r=new T(c.FORM,e);for(const t in k)r.addField(t,k[t]);return r}const z=(e,r)=>{const t=e.delivery_method;if(t==="nova_poshta"){const o={country:e.country,region:e.region,city:e.city};delete e.country,delete e.region,delete e.city,e.nova_poshta=o}else if(t==="courier"){const o={address:e.address};delete e.address,e.courier=o}return delete e.dalivery_method,!e.delivery_method&&t&&(e.delivery_method=t),{...e,products:r}},J=()=>{const e=B(),r=Q().onSuccess(async p=>{p.preventDefault();const s=f.getState().cart.items,i=f.getState().cart.products,l=document.querySelector(c.FORM),_=new FormData(l),a=Object.fromEntries(_.entries()),d=z(a,s);d.total_amount=t(s,i),e.show();try{await A.createOrder(d),f.dispatch({type:"cart/clearCart"}),C(`${E}thank-you/`,0,!0)}catch(y){console.error("Order error:",y)}finally{e.hide()}});function t(p,s){const i=new Map;p.forEach(a=>{i.set(Number(a.productId),a.quantity)});const l=i||new Map,_=1;return s.reduce((a,d)=>{const y=l.get(d.id)||_;return a+y*d.price},0)}const o=b({selector:".checkout-form__region-dropdown",disabled:!0}),m=b({selector:".checkout-form__country-dropdown",items:U,onChange:(p,s)=>{j(s,o,P)}});K(r,{countryDropdown:m,regionDropdown:o})};function K(e,r){const{countryDropdown:t,regionDropdown:o}=r,m=document.getElementById("checkout-form"),p=m.querySelectorAll('input[name="delivery_method"]'),s=m.querySelector(".nova_poshta__fields"),i=m.querySelector(".courier__fields"),l=(n,v)=>{if(!n)return;n.querySelectorAll("input, select, textarea").forEach(S=>{S.disabled=v})},_=n=>{if(!n)return;n.querySelectorAll(".dropdown_select").forEach(u=>{const S=u.querySelector(".dropdown__selected"),w=u.querySelector('.dropdown__option[aria-selected="true"]');S.innerHTML=S.dataset.placeholder,w&&w.removeAttribute("aria-selected")})},a=n=>{if(!n)return;n.querySelectorAll("input, select, textarea").forEach(u=>{u.type==="checkbox"||u.type==="radio"?u.checked=!1:u.value=""}),_(n)};let d="";const y=n=>{t.reset(),o.reset(),o.setDisabled(!0),a(s),a(i),d==="nova_poshta"&&X(e),d==="courier"&&ee(e),l(s,!0),l(i,!0),s.classList.add("hidden"),i.classList.add("hidden"),n==="nova_poshta"&&(s.classList.remove("hidden"),l(s,!1),W(e)),n==="courier"&&(i.classList.remove("hidden"),l(i,!1),Z(e)),d=n};p.forEach(n=>{n.addEventListener("change",()=>y(n.value))});const g=document.querySelector('input[name="delivery_method"]:checked');g&&y(g.value)}function j(e,r,t){const o=t[e]||[];r.updateOptions(o),o.length>0?r.setDisabled(!1):r.setDisabled(!0)}function W(e){[[c.COUNTRY,[h]],[c.REGION,[h]],[c.CITY,[h]]].forEach(([t,o])=>{e.addField(t,o)})}function X(e){[c.COUNTRY,c.REGION,c.CITY].forEach(t=>{e.removeField(t)})}function Z(e){e.addField(c.ADDRESS,[h])}function ee(e){e.removeField(c.ADDRESS)}const L=[{key:"productName",label:"Товар",type:"text",width:"1fr",align:"left"},{key:"quantity",label:"Кол-во",type:"component",render:e=>new M(e.quantity,e.id).element,width:"1fr"},{key:"price",label:"Цена за товар",type:"currency",width:"1fr",render:e=>F(e.price,"грн.")},{key:"total",label:"Итоговая стоимость",type:"currency",width:"1fr",render:e=>F(e.total,"грн.")}],O={leftAction:null,rightGroup:[{type:"total",text:"Всего",amountKey:"totalAmount",unit:"грн."}]},te=async()=>{const e=document.querySelector(".checkout-section__cart"),t=new URLSearchParams(window.location.search).get("orderId");if(!t)N({container:e,columns:L,footer:O});else{const o=await A.getOrderById(t),m=I(o.products,o.items);H({container:e,columns:L,footer:O,rows:m})}J()},re=()=>{$(".checkout-page-breadcrumbs__container","breadcrumbs_color_muted")};document.addEventListener("DOMContentLoaded",async()=>{const r=new URLSearchParams(window.location.search).get("orderId");await oe(r),r||f.subscribe("cart",()=>{f.getState().cart.items.length===0&&C(`${E}`,0,!0)}),f.subscribe("auth",t=>{t.isAuth||C(`${E}`,0,!0)}),b({selector:".top-header__lang"}),D(),re(),te(),R(),q(".lazy",{rootMargin:"200px 0px"})});async function oe(e){const r=await G(),t=f.getState().cart.items.length===0;if(!r){C(`${E}`,0,!0);return}if(!e&&t){C(`${E}`,0,!0);return}const o=document.querySelector("#private-content");o&&o.removeAttribute("id")}
