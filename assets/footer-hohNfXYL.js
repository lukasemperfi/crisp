(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}})();function q(e=".nav-menu__link",t="active"){const s=r=>r?"/"+r.replace(/^\/+|\/+$/g,""):"/",o=s(window.location.pathname);document.querySelectorAll(e).forEach(r=>{const i=r.getAttribute("href");if(!i||i.startsWith("#"))return;s(i)===o?(r.classList.add(t),r.style.pointerEvents="none",r.style.cursor="default",r.setAttribute("aria-disabled","true")):(r.classList.remove(t),r.style.pointerEvents="",r.style.cursor="",r.removeAttribute("aria-disabled"))})}const u="",d={IDLE:"idle",LOADING:"loading",SUCCEEDED:"succeeded",FAILED:"failed"},D={items:[],status:d.IDLE,error:null,lastFetched:null,cachedProducts:[],cachedStatus:"idle",cachedError:null},T={name:"products",initialState:D,reducers:{setLoading:e=>({...e,status:d.LOADING,error:null}),setProducts:(e,t)=>({...e,items:t.payload,status:d.SUCCEEDED,error:null,lastFetched:new Date().toISOString()}),setError:(e,t)=>({...e,status:d.FAILED,error:t.payload}),clearError:e=>({...e,error:null}),reset:()=>D,setCachedLoading:e=>({...e,cachedStatus:d.LOADING,cachedError:null}),setCachedProducts:(e,t)=>({...e,cachedProducts:t.payload,cachedStatus:d.SUCCEEDED,cachedError:null}),setCachedError:(e,t)=>({...e,cachedStatus:d.FAILED,cachedError:t.payload})}},x={name:"productFilters",initialState:{filters:{weight:[],flavor:[],sort:null},isInitialized:!1},reducers:{setFilters:(e,t)=>({...e,filters:{...e.filters,...t.payload}}),setInitialized:(e,t)=>({...e,isInitialized:t.payload}),resetFilters:e=>({...e,filters:{weight:[],flavor:[],sort:null}})}},L={IDLE:"idle",LOADING:"loading",SUCCEEDED:"succeeded",FAILED:"failed"},_={item:null,status:L.IDLE,error:null,lastFetched:null,currentId:null},z={name:"product",initialState:_,reducers:{setLoading:e=>({...e,status:L.LOADING,error:null}),setProduct:(e,t)=>({...e,item:t.payload,status:L.SUCCEEDED,error:null,lastFetched:new Date().toISOString(),currentId:t.payload?.id||null}),setError:(e,t)=>({...e,status:L.FAILED,error:t.payload,item:null}),clearError:e=>({...e,error:null}),reset:()=>_}};class ${onAuthChange(t){const{data:s}=u.auth.onAuthStateChange((o,r)=>{t(o,r)});return()=>{s.subscription.unsubscribe()}}async login({email:t,password:s}){const{data:o,error:r}=await u.auth.signInWithPassword({email:t,password:s});if(r)throw r;return o}async logout(){const{error:t}=await u.auth.signOut();if(t)throw t;return!0}async registerUser(t){const{email:s,password:o,full_name:r,phone:i,person_type:n,upload_file:a,country:f,region:S,city:E,address:h}=t,{data:g,error:I}=await u.auth.signUp({email:s,password:o});if(I)throw console.error("Ошибка регистрации в Auth:",I.message),I;const p=g.user.id;let b=null;if(a&&a.name){const y=a.name.split(".").pop(),l=`${p}.${y}`,{error:v}=await u.storage.from("avatars").upload(l,a,{cacheControl:"no-cache",upsert:!0});v&&console.warn("Предупреждение: Ошибка загрузки аватара, продолжение регистрации:",v.message);const{data:U}=u.storage.from("avatars").getPublicUrl(l);b=U.publicUrl}const F={id:p,full_name:r,phone:i,country:f||null,region:S||null,city:E||null,address:h||null,person_type:n,avatar_url:b},{error:A}=await u.from("profiles").insert([F]);if(A)throw console.error("Ошибка вставки в profiles:",A.message),A;if(n==="fop"&&t.fop){const y={profile_id:p,edrpou:t.fop.edrpou,country:t.fop.country||null,region:t.fop.region||null,city:t.fop.city||null,address:t.fop.address||null},{error:l}=await u.from("fop_details").insert([y]);if(l)throw console.error("Ошибка вставки в fop_details:",l.message),l}else if(n==="legal"&&t.legal_entity){const y={profile_id:p,okpo:t.legal_entity.okpo,country:t.legal_entity.country||null,region:t.legal_entity.region||null,city:t.legal_entity.city||null,address:t.legal_entity.address||null,postal_code:t.legal_entity.postal_code||null},{error:l}=await u.from("legal_entity_details").insert([y]);if(l)throw console.error("Ошибка вставки в legal_entity_details:",l.message),l}return g}}const P=new $,m={IDLE:"idle",LOADING:"loading",SUCCEEDED:"succeeded",FAILED:"failed"},C={user:null,session:null,isAuth:!1,status:m.IDLE,error:null},M={name:"auth",initialState:C,reducers:{setLoading:(e,t)=>({...e,status:m.LOADING,error:null}),setAuth:(e,t)=>({...e,status:m.SUCCEEDED,error:null,user:t.payload.user,session:t.payload.session,isAuth:!!t.payload.session}),setError:(e,t)=>({...e,status:m.FAILED,error:t.payload,user:null,session:null,isAuth:!1}),clearError:e=>({...e,error:null}),resetAuth:()=>C}};async function W(e){if(c.getState().auth.status!==m.LOADING){c.dispatch({type:"auth/setLoading"});try{const s=await P.registerUser(e);return c.dispatch({type:"auth/setAuth",payload:{user:s.user,session:s.session}}),s}catch(s){const o=s.message||"Не удалось завершить регистрацию";throw c.dispatch({type:"auth/setError",payload:o}),s}}}async function J(e,t){c.dispatch({type:"auth/setLoading"});try{const s=await P.login({email:e,password:t});return c.dispatch({type:"auth/setAuth",payload:{user:s.user,session:s.session}}),s}catch(s){throw c.dispatch({type:"auth/setError",payload:s.message}),s}}const G={IDLE:"idle"},O={items:[],status:G.IDLE,error:null,products:[],isProductsLoading:!1,productsError:null},N={name:"cart",initialState:O,reducers:{addItem:(e,t)=>{const s=String(t.payload.productId);return e.items.find(r=>r.productId===s)?{...e,items:e.items.map(r=>r.productId===s?{...r,quantity:r.quantity+1}:r)}:{...e,items:[...e.items,{productId:s,quantity:1}]}},removeItem:(e,t)=>{const s=String(t.payload.productId);return{...e,items:e.items.filter(o=>o.productId!==s),products:e.products.filter(o=>String(o.id)!==s)}},incrementQuantity:(e,t)=>{const s=t.payload.productId;return e.items.find(r=>r.productId===s)?{...e,items:e.items.map(r=>r.productId===s?{...r,quantity:r.quantity+1}:r)}:{...e,items:[...e.items,{productId:s,quantity:1}]}},decrementQuantity:(e,t)=>{const s=t.payload.productId,o=e.items.find(r=>r.productId===s);return o?o.quantity<=1?{...e,items:e.items.filter(r=>r.productId!==s)}:{...e,items:e.items.map(r=>r.productId===s?{...r,quantity:r.quantity-1}:r)}:e},setQuantity:(e,t)=>{const{productId:s,quantity:o}=t.payload;return o<=0?{...e,items:e.items.filter(i=>i.productId!==s)}:e.items.find(i=>i.productId===s)?{...e,items:e.items.map(i=>i.productId===s?{...i,quantity:o}:i)}:{...e,items:[...e.items,{productId:s,quantity:o}]}},clearCart:()=>O,setCartProductsLoading:e=>({...e,isProductsLoading:!0,productsError:null}),setCartProducts:(e,t)=>({...e,products:t.payload,isProductsLoading:!1,productsError:null}),setCartProductsError:(e,t)=>({...e,isProductsLoading:!1,productsError:t.payload})}};class H{constructor(){this.state={},this.reducers={},this.listeners=new Map,this.persistConfig={},this.storageKey="app_store"}registerSlice(t,s={persist:!1,fields:null}){const r=this.loadFullStoreFromStorage()[t.name],i=r?{...t.initialState,...r}:t.initialState;this.state[t.name]=i,this.reducers[t.name]=t.reducers,this.persistConfig[t.name]=s}getState(){return this.state}dispatch(t){const[s,o]=t.type.split("/");if(!s||!o){console.error(`Некорректный action.type: ${t.type}. Ожидается 'slice/reducer'.`);return}const r=this.reducers[s];if(!r||!r[o]){console.warn(`Не найден редьюсер ${o} в слайсе ${s}.`);return}const i=r[o],n=this.state[s],a=i(n,t);this.state[s]=a,this.saveSliceToFullStorage(s,a),this.notify(s,a)}subscribe(t,s){this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(s);const o=this.state[t];o!==void 0&&s(o)}unsubscribe(t,s){this.listeners.has(t)&&(this.listeners.get(t).delete(s),this.listeners.get(t).size===0&&this.listeners.delete(t))}notify(t,s){this.listeners.has(t)&&this.listeners.get(t).forEach(o=>{o(s)})}loadFullStoreFromStorage(){const t=localStorage.getItem(this.storageKey);if(!t)return{};try{return JSON.parse(t)}catch{return{}}}saveSliceToFullStorage(t,s){const o=this.persistConfig[t];if(!o?.persist)return;const r=this.loadFullStoreFromStorage();let i=s;Array.isArray(o.fields)&&(i={},o.fields.forEach(n=>{s.hasOwnProperty(n)&&(i[n]=s[n])})),r[t]=i,localStorage.setItem(this.storageKey,JSON.stringify(r))}}const c=new H;c.registerSlice(M);c.registerSlice(N,{persist:!0,fields:["items"]});c.registerSlice(T);c.registerSlice(x);c.registerSlice(z);const j="/crisp/";async function k(){R(),K(),q(".nav-menu__link"),B()}function R(){const e=document.querySelector(".header__burger-btn"),t=document.querySelector(".mobile-menu");if(!e||!t)return;e.addEventListener("click",function(){const o=t.classList.toggle("is-open");e.setAttribute("aria-expanded",o?"true":"false"),document.body.style.overflow=o?"hidden":"auto"}),document.addEventListener("click",o=>{const r=t.contains(o.target),i=e.contains(o.target);!r&&!i&&t.classList.contains("is-open")&&s()}),document.addEventListener("keydown",o=>{o.key==="Escape"&&t.classList.contains("is-open")&&s()});function s(){t.classList.remove("is-open"),e.setAttribute("aria-expanded","false"),document.body.style.overflow="auto"}}function K(){const e=document.querySelector(".mobile-menu"),t=document.querySelector(".header__burger-btn");!e||!t||window.addEventListener("resize",function(){e.classList.contains("is-open")&&(e.classList.remove("is-open"),t.setAttribute("aria-expanded","false"),document.body.style.overflow="auto")})}function B(e=".header"){const t=document.querySelector(e);if(!t)return null;const s=document.documentElement,o=new ResizeObserver(r=>{const i=r[0].target.offsetHeight;s.style.setProperty("--header-height",`${i}px`)});return o.observe(t),o}function V(e=".lazy",t={}){const o={...{root:null,rootMargin:"0px",threshold:.01},...t},r=document.querySelectorAll(e);if("IntersectionObserver"in window){let i=r.length;const n=(f,S)=>{f.forEach(E=>{if(E.isIntersecting){const h=E.target;w(h,e);const g=h.closest("picture");g&&g.querySelectorAll("source[data-srcset]").forEach(p=>w(p,e)),S.unobserve(h),i--,i===0&&S.disconnect()}})},a=new IntersectionObserver(n,o);r.forEach(f=>{a.observe(f)})}else r.forEach(i=>w(i,e))}function w(e,t){const s=e.tagName.toLowerCase()==="iframe",o="/crisp/";e.dataset.src&&(e.src=s?e.dataset.src:o+e.dataset.src.replace(/^\/+/,""),delete e.dataset.src),e.dataset.srcset&&(e.srcset=s?e.dataset.srcset:o+e.dataset.srcset.replace(/^\/+/,""),delete e.dataset.srcset),e.classList.contains(t.replace(".",""))&&e.classList.remove(t.replace(".",""))}const X=()=>{Q()},Q=(e=".js-accordion-title",t=".page-footer-item",s=500)=>{const o=document.querySelectorAll(e);o.length&&o.forEach(r=>{r.addEventListener("click",()=>{if(window.innerWidth<=s){const i=r.closest(t),n=i.classList.contains("is-active");document.querySelectorAll(t).forEach(a=>{a.classList.remove("is-active")}),n||i.classList.add("is-active")}})})};export{m as A,X as a,j as b,u as c,J as d,k as i,V as l,W as r,c as s};
